<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lectura Rápida</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #text-container {
            font-family: Arial, sans-serif; /* Fuente de letra */
            font-size: 10px; /* Tamaño inicial de la fuente */
            line-height: 1.5;
            max-width: 90%; /* Max ancho del contenedor */
            margin: auto;
            white-space: pre-wrap;
            height: auto; /* Ajustar altura automáticamente */
            max-height: 75vh; /* Altura máxima relativa a la ventana */
            overflow: hidden;
            text-align: justify;
            background-color: #f5f5f5; /* Fondo claro para mejor lectura */
            padding: 10px;
            border-radius: 10px; /* Esquinas redondeadas */
        }
        .line {
            opacity: 0.3;
        }
        .highlight {
            opacity: 1;
            background-color: rgba(255, 255, 0, 0.5);
        }
        #controls {
            margin-top: 20px;
            text-align: center;
        }
        button, label, input {
            margin: 5px;
            padding: 10px;
            font-size: 1.2em; /* Tamaño de fuente relativo */
        }
        #progress-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        #progress-bar {
            width: 80%;
            height: 20px;
        }
        #progress-percentage {
            margin-left: 10px;
            font-size: 1.2em;
        }
        @media (max-width: 600px) {
            #text-container {
                font-size: 4vw; /* Ajuste de tamaño de fuente para pantallas pequeñas */
            }
            button, label, input {
                font-size: 1em; /* Ajuste de tamaño de controles para pantallas pequeñas */
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <h1>Lectura Rápida</h1>
    <input type="file" id="file-input" accept=".txt">
    <div id="text-container"></div>
    <div id="progress-container">
        <input type="range" id="progress-bar" min="0" max="100" value="0">
        <span id="progress-percentage">0%</span>
    </div>
    <div id="controls">
        <button onclick="startReading()">Iniciar Lectura</button>
        <button onclick="pauseReading()">Pausar</button>
        <button onclick="resumeReading()">Reanudar</button>
        <button onclick="increaseSpeed()">Aumentar Velocidad</button>
        <button onclick="decreaseSpeed()">Disminuir Velocidad</button>
        <p>Velocidad actual: <span id="current-speed">500</span> palabras por minuto</p>
        <label for="words-per-line">Palabras por renglón:</label>
        <button onclick="decreaseWordsPerLine()">-</button>
        <span id="words-per-line-display">10</span>
        <button onclick="increaseWordsPerLine()">+</button>
    </div>
    <div>
        <p>Total de palabras: <span id="total-words">0</span></p>
        <p>Palabras leídas: <span id="words-read">0</span></p>
        <p>Porcentaje de avance: <span id="reading-progress">0%</span></p>
    </div>

    <script>
        let words = [];
        let currentLineIndex = 0;
        let intervalId;
        let currentSpeed = 1200; // Velocidad en ms por línea
        let wordsPerMinute = 500; // Velocidad inicial en palabras por minuto
        const textContainer = document.getElementById('text-container');
        const currentSpeedDisplay = document.getElementById('current-speed');
        const wordsPerLineDisplay = document.getElementById('words-per-line-display');
        const progressBar = document.getElementById('progress-bar');
        const progressPercentage = document.getElementById('progress-percentage');
        let wordsPerLine = 10;
        const linesPerPage = 10; // Reducido a 10 renglones por página
        let lines = [];

        document.getElementById('file-input').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    words = text.split(/\s+/);
                    textContainer.textContent = '';
                    formatText();
                    updateWordCount();
                };
                reader.readAsText(file);
            }
        });

        progressBar.addEventListener('input', function() {
            const percentage = progressBar.value;
            currentLineIndex = Math.floor((percentage / 100) * lines.length);
            displayNextPage();
        });

        function formatText() {
            let pageContent = '';
            lines = [];
            for (let i = 0; i < words.length; i++) {
                if (i % wordsPerLine === 0 && i !== 0) {
                    pageContent += '\n';
                }
                pageContent += words[i] + ' ';
            }
            lines = pageContent.trim().split('\n');
            displayNextPage();
        }

        function displayNextPage() {
            textContainer.innerHTML = '';
            const startLine = currentLineIndex;
            const endLine = Math.min(currentLineIndex + linesPerPage, lines.length);
            for (let i = startLine; i < endLine; i++) {
                const lineDiv = document.createElement('div');
                lineDiv.textContent = lines[i];
                lineDiv.className = 'line';
                if (i === startLine) {
                    lineDiv.classList.add('highlight');
                }
                textContainer.appendChild(lineDiv);
            }
            updateProgress();
        }

        function highlightNextLine() {
            const currentLine = textContainer.querySelector('.highlight');
            if (currentLine) {
                currentLine.classList.remove('highlight');
                currentLine.classList.add('line');
                if (currentLine.nextElementSibling) {
                    currentLine.nextElementSibling.classList.remove('line');
                    currentLine.nextElementSibling.classList.add('highlight');
                } else {
                    currentLineIndex += linesPerPage; // Mover al siguiente conjunto de líneas
                    if (currentLineIndex < lines.length) {
                        displayNextPage();
                    } else {
                        clearInterval(intervalId);
                    }
                }
            }
        }

        function startReading() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(highlightNextLine, currentSpeed);
        }

        function pauseReading() {
            clearInterval(intervalId);
        }

        function resumeReading() {
            intervalId = setInterval(highlightNextLine, currentSpeed);
        }

        function increaseSpeed() {
            wordsPerMinute += 50;
            updateSpeed();
        }

        function decreaseSpeed() {
            if (wordsPerMinute > 50) {
                wordsPerMinute -= 50;
                updateSpeed();
            }
        }

        function updateSpeed() {
            clearInterval(intervalId);
            currentSpeed = calculateSpeed(wordsPerMinute);
            currentSpeedDisplay.textContent = wordsPerMinute;
            intervalId = setInterval(highlightNextLine, currentSpeed);
        }

        function calculateSpeed(wpm) {
            // Convertir palabras por minuto a ms por línea
            const msPerWord = 60000 / wpm;
            return msPerWord * wordsPerLine;
        }

        function increaseWordsPerLine() {
            if (wordsPerLine < 12) {
                wordsPerLine++;
                wordsPerLineDisplay.textContent = wordsPerLine;
                reformatText();
                adjustFontSize();
            }
        }

        function decreaseWordsPerLine() {
            if (wordsPerLine > 3) {
                wordsPerLine--;
                wordsPerLineDisplay.textContent = wordsPerLine;
                reformatText();
                adjustFontSize();
            }
        }

        function adjustFontSize() {
            const fontSize = 10 + (wordsPerLine - 3) * 2; // Incrementar tamaño de fuente
            textContainer.style.fontSize = fontSize + 'px';
        }

        function reformatText() {
            clearInterval(intervalId);
            currentLineIndex = 0;
            formatText();
            intervalId = setInterval(highlightNextLine, currentSpeed);
        }

        function updateWordCount() {
            document.getElementById('total-words').textContent = words.length;
        }

        function updateProgress() {
            const wordsRead = currentLineIndex * wordsPerLine;
            const totalWords = words.length;
            const progress = (wordsRead / totalWords) * 100;
            document.getElementById('words-read').textContent = wordsRead;
            document.getElementById('reading-progress').textContent = progress.toFixed(2) + '%';
            progressBar.value = progress.toFixed(2);
            progressPercentage.textContent = progress.toFixed(2) + '%';
        }

        // Set default speed to 500 words per minute on load
        window.onload = function
        // Set default speed to 500 words per minute on load
        window.onload = function() {
            currentSpeed = calculateSpeed(wordsPerMinute); // 500 wpm
            currentSpeedDisplay.textContent = wordsPerMinute;
            wordsPerLineDisplay.textContent = wordsPerLine;
            adjustFontSize();
        };
    </script>
</body>
</html>
